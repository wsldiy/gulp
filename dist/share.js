var baseUrl="https://api.clotfun.online/",openDate=Date.now();function getUrlParam(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(o);return null!=a?decodeURIComponent(a[2]):null}var setCookie=function(e,o){var a=new Date;a.setTime(a.getTime()+6048e5),document.cookie=e+"="+encodeURIComponent(o)+";expires="+a.toGMTString()},getCookie=function(e){var o,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(o=document.cookie.match(a))?decodeURIComponent(o[2]):null},options={},cookie_uid=getCookie("hdgg_uid");function setupWebViewJavascriptBridge(e){if(window.WebViewJavascriptBridge)return e(WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var o=document.createElement("iframe");o.style.display="none",o.src="https://__bridge_loaded__",document.documentElement.appendChild(o),setTimeout(function(){document.documentElement.removeChild(o)},0)}var player,player2,player3,playing,params={},videoList={},u=navigator.userAgent,app=navigator.appVersion,isAndroid=-1<u.indexOf("Android")||-1<u.indexOf("Linux"),isIOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),iosSdk="",androidSdk="",flag=!0;if(isAndroid){try{function onGetSystemType(e){if(androidSdk=e)if(cookie_uid)entrance();else try{window.android.onPostDeviceInfo()}catch(e){}}window.android.onPostSystemType()}catch(e){getUid()}function onGetDeviceInfo(e){(params=e).uid?(cookie_uid=params.uid,entrance()):getAndroidUid(params)}function onShareComplete(e){}function onStartDownload(e){}function onDownloadSuccess(e){}}else isIOS&&-1<u.indexOf("iosSdk")?(iosSdk="iosSdk",getIosUid()):getUid();function getAndroidUid(e){options={deviceId:e.deviceId,imsi:e.imsi,mobile:e.phoneNumber||"",model:e.model,brand:e.brand,packageName:e.package,platform:e.system,screen:e.screen},$.ajax({type:"POST",url:baseUrl+"device/getUid",data:JSON.stringify(options),async:!1,headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){cookie_uid=e.result,setCookie("hdgg_uid",cookie_uid),window.android.onSaveUid(cookie_uid),entrance()}})}function getIosUid(){cookie_uid?entrance():setupWebViewJavascriptBridge(function(a){a.callHandler("onPostDeviceInfo",function(e){var o=e;o.uid?(cookie_uid=o.uid,entrance()):(options={deviceId:o.deviceId,imsi:o.imsi,mobile:o.phoneNumber||"",model:o.model,brand:o.brand,packageName:o.package,platform:o.system,screen:o.screen},$.ajax({type:"POST",url:baseUrl+"device/getUid",data:JSON.stringify(options),async:!1,headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){cookie_uid=e.result,setCookie("hdgg_uid",cookie_uid),entrance(),a.callHandler("onSaveUid",{uid:cookie_uid},function(e){})}}))})})}function getUid(){cookie_uid?entrance():(options={deviceId:"",imsi:"",mobile:"",model:"",brand:"",packageName:"",platform:"",screen:""},$.ajax({type:"POST",url:baseUrl+"device/getUid",data:JSON.stringify(options),async:!1,headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){200==e.code&&(cookie_uid=e.result,setCookie("hdgg_uid",cookie_uid),entrance())}}))}function entrance(){var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,promotionNetwork:1,uid:cookie_uid,hdggAdvInfoId:getUrlParam("hdggAdvInfoId"),advLayout:getUrlParam("advLayout")};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/shareBack",data:JSON.stringify(e),async:!1,headers:{"Content-Type":"application/json"},success:function(e){}});var o={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,promotionNetwork:1,uid:cookie_uid,advInfoId:getUrlParam("hdggAdvInfoId"),advLayout:getUrlParam("advLayout")};$.ajax({type:"POST",url:baseUrl+"entrance/shareVideo",data:JSON.stringify(o),async:!1,headers:{"Content-Type":"application/json"},success:function(e){0==e.code&&(videoList=e.data,$("body").addClass("videoBg").css("background-image","url("+videoList.videoInfoList[0].firstFrame+")"),$("body").append('<div style="display: none;" id="shareIcon"><img style="width: 300px;height: 300px;" src="'+videoList.videoInfoList[0].firstFrame+'"></div>'),boFang())}})}function play(){playing.audioOut.unlock(),playing.play()}function voiceAlarm(e){var o=e.audioOut;"suspended"!==e.audioOut.context.state&&0!==o.volume&&e.audioOut.unlocked?$("#openCloseMuted").addClass("openAudio"):($("#openCloseMuted").removeClass("openAudio"),o.volume=0)}function switch2(){var e=playing.audioOut;e.unlock(),0===e.volume?(e.volume=1,$("#openCloseMuted").addClass("openAudio")):0<e.volume&&(e.volume=0,$("#openCloseMuted").removeClass("openAudio"))}function boFang(){"{}"!=JSON.stringify(videoList)&&(player=new JSMpeg.Player(videoList.videoInfoList[0].playURL,{autoplay:!0,disableGl:!0,disableWebAssembly:!0,loop:!1,progressive:!0,chunkSize:524288,canvas:document.querySelector("#canvas"),onPlay:function(){$("#canvas").show(),voiceAlarm(player),$("body").removeClass("videoBg").css("background-color","#000").css("background-image","url()"),$("#openCloseMuted").show();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:videoList.videoInfoList[0].videoId};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/play",data:JSON.stringify(e),headers:{"Content-Type":"application/json"},success:function(e){}})},onEnded:function(){player2=new JSMpeg.Player(videoList.videoInfoList[1].playURL,{disableGl:!0,disableWebAssembly:!0,loop:!1,progressive:!1,poster:videoList.videoInfoList[1].firstFrame,canvas:document.querySelector("#canvas2"),onPlay:function(){$("#canvas2").show(),player2.audioOut.unlock(),player2.audioOut.volume=player.volume,voiceAlarm(player2),$("body").removeClass("videoBg2").css("background-image","url()")},onEnded:function(){$("#openCloseMuted").hide();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:""};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/endPlay",data:JSON.stringify(e),headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){alertCommon(),closeBtn(),closeGo(),share(),endCardShow()}})}}),player3=new JSMpeg.Player(videoList.videoInfoList[2].playURL,{disableGl:!0,disableWebAssembly:!0,loop:!1,progressive:!1,poster:videoList.videoInfoList[2].firstFrame,canvas:document.querySelector("#canvas3"),onPlay:function(){$("#canvas3").show(),player3.audioOut.unlock(),player3.audioOut.volume=player.volume,voiceAlarm(player3),$("body").removeClass("videoBg2").css("background-image","url()")},onEnded:function(){$("#openCloseMuted").hide();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:""};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/endPlay",data:JSON.stringify(e),headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){alertCommon(),closeBtn(),closeGo(),share(),endCardShow()}})}}),$("#choice").show(),$("#openCloseMuted").hide(),$("#question").text(videoList.videoInfoList[0].content),$("#choiceA").text(videoList.videoInfoList[1].content),$("#choiceB").text(videoList.videoInfoList[2].content),4==videoList.videoInfoList.length&&($("#choiceC").show(),player4=new JSMpeg.Player(videoList.videoInfoList[3].playURL,{disableGl:!0,disableWebAssembly:!0,loop:!1,progressive:!1,poster:videoList.videoInfoList[3].firstFrame,canvas:document.querySelector("#canvas4"),onPlay:function(){$("#canvas4").show(),player4.audioOut.unlock(),player4.audioOut.volume=player.volume,voiceAlarm(player4),$("body").removeClass("videoBg2").css("background-image","url()")},onEnded:function(){$("#openCloseMuted").hide();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:""};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/endPlay",data:JSON.stringify(e),headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){alertCommon(),closeBtn(),closeGo(),share(),endCardShow()}})}}),$("#choiceC").text(videoList.videoInfoList[3].content))}}),(playing=player).audioOut.unlock())}function replay(){player.seek(0),player2.seek(0),player3.seek(0),4==videoList.videoInfoList.length&&player4.seek(0),playing=player,play()}function endCardShow(){var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:""};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/endCardShow",data:JSON.stringify(e),async:!1,headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){}})}window.styleReset=function(){$("#hdgg_show-win-custom-pdd").addClass("hidem"),$("#hdgg_show-win-custom-pdd").remove(),flag=!0,$("#redBag,#endChoice").show()},$("#redBag").click(function(){alertCommon(),closeBtn(),closeGo(),share()}),$("#loop").click(function(){$("#redBag,#endChoice").hide(),$("#canvas").show(),$("#canvas2").hide(),$("#canvas3").hide(),$("#canvas4").hide(),$("#openCloseMuted").show(),replay()}),$("#next").click(function(){location.reload()}),document.querySelector("#openCloseMuted").addEventListener("click",switch2,!0),$("#choiceA").click(function(){$("#choice").hide(),$("#canvas").hide(),$("#openCloseMuted").show(),$("body").addClass("videoBg2").css("background-image","url("+videoList.videoInfoList[1].firstFrame+")"),playing=player2,play();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:videoList.videoInfoList[1].videoId};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/interaction",data:JSON.stringify(e),headers:{"Content-Type":"application/json"},success:function(e){}})}),$("#choiceB").click(function(){$("#choice").hide(),$("#canvas").hide(),$("#openCloseMuted").show(),$("body").addClass("videoBg2").css("background-image","url("+videoList.videoInfoList[2].firstFrame+")"),playing=player3,play();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:videoList.videoInfoList[2].videoId};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/interaction",data:JSON.stringify(e),headers:{"Content-Type":"application/json"},success:function(e){}})}),$("#choiceC").click(function(){$("#choice").hide(),$("#canvas").hide(),$("#openCloseMuted").show(),$("body").addClass("videoBg2").css("background-image","url("+videoList.videoInfoList[3].firstFrame+")"),playing=player4,play();var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:videoList.videoInfoList[2].videoId};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/interaction",data:JSON.stringify(e),headers:{"Content-Type":"application/json"},success:function(e){}})});var haveShare=1;function share(){$("#hdgg_show-win-custom-pdd").on("click","#shareBtn",function(){if(1===haveShare){var e={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/share",data:JSON.stringify(e),headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){haveShare=2}})}if(androidSdk)window.android.onShare(JSON.stringify({shareUrl:window.location.href}));else if(iosSdk)setupWebViewJavascriptBridge(function(e){e.registerHandler("onShareComplete",function(e,o){o("oc告诉我分享成功")}),e.callHandler("onShare",{shareUrl:window.location.href},function(e){})});else{var o=new ClipboardJS("#shareBtn",{text:function(){return window.location.href}});o.on("success",function(){$("#hdgg_show-win-custom-pdd").append('<div id="shareSuccess">\n  <span>复制成功</span>\n</div>'),setTimeout(function(){$("#shareSuccess").remove(),o.destroy()},1500)}),o.on("error",function(e){alert("复制失败")})}})}function alertCommon(){var e='<div id="hdgg_show-win-custom-pdd">\n        <img id="hdgg-image-custom-pdd" class="m-image" src="'+videoList.endCardUrl+'">\n        <div class="card-sunshine"></div>\n      <span class="close-btn closetc iconfont"></span></div>';$("body").append(e),setTimeout(function(){$("#hdgg_show-win-custom-pdd").append('<button id="shareBtn">点击分享</button>')},1e3)}function closeBtn(){$("#hdgg_show-win-custom-pdd").on("click",".close-btn",function(){window.styleReset()})}function closeGo(){$("#hdgg_show-win-custom-pdd img").on("click",function(e){e.preventDefault(),e.stopPropagation();var o={appkey:getUrlParam("appkey"),adSpaceKey:getUrlParam("adSpaceKey"),mobileSystem:1,uid:cookie_uid,advLayout:1,hdggAdvInfoId:videoList.advInfoId,videoId:""};$.ajax({type:"POST",url:baseUrl+"bhideo/statistics/endCardClick",data:JSON.stringify(o),async:!1,headers:{"Content-Type":"application/json;charset=utf8"},success:function(e){window.location.href=-1<videoList.endUrl.indexOf("?")?videoList.endUrl+"&"+location.search.split("?")[1].replace("LVJWKMDA","")+"&hdggAdvInfoId="+videoList.advInfoId+"&doumobkey="+videoList.doumobkey+"&advMaterialId="+videoList.advMaterialId:videoList.endUrl+"?"+location.search.split("?")[1].replace("LVJWKMDA","")+"&hdggAdvInfoId="+videoList.advInfoId+"&doumobkey="+videoList.doumobkey+"&advMaterialId="+videoList.advMaterialId}})})}